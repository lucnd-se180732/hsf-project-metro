<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
    <title layout:fragment="title">V√© c·ªßa t√¥i</title>

    <th:block layout:fragment="styles">
        <link rel="stylesheet" href="/css/ticket.css">
    </th:block>
</head>

<body class="ticket-page">
<div layout:fragment="content">

    <!-- üîò Tabs chuy·ªÉn lo·∫°i v√© -->
    <div class="tabs">
        <a th:href="@{/tickets(type='active')}" th:classappend="${activeTab == 'active'} ? 'active'">ƒê√£ k√≠ch ho·∫°t</a>
        <a th:href="@{/tickets(type='inactive')}" th:classappend="${activeTab == 'inactive'} ? 'active'">Ch∆∞a k√≠ch ho·∫°t</a>
        <a th:href="@{/tickets(type='expired')}" th:classappend="${activeTab == 'expired'} ? 'active'">ƒê√£ h·∫øt h·∫°n</a>
    </div>

    <!-- ‚ùå Kh√¥ng c√≥ v√© -->
    <div class="no-ticket-message" th:if="${tickets.isEmpty()}">
        <p>üö´ Hi·ªán t·∫°i b·∫°n ch∆∞a c√≥ v√© n√†o.</p>
    </div>

    <!-- ‚úÖ Danh s√°ch v√© -->
    <div class="ticket-list-wrapper" th:if="${!tickets.isEmpty()}">
        <div th:each="ticket : ${tickets}" class="ticket-card">
            <div class="ticket-info">
                <h2 th:text="|Lo·∫°i v√©: ${ticket.ticketType.displayName}|"></h2>
                <p th:if="${ticket.departureStation != null}">
                    Ga ƒëi: <span th:text="${ticket.departureStation}"></span>
                    ‚Äì Ga ƒë·∫øn: <span th:text="${ticket.arrivalStation}"></span>
                </p>
                <p>Ng√†y b·∫Øt ƒë·∫ßu: <span th:text="${#temporals.format(ticket.startDate, 'dd/MM/yyyy HH:mm')}"></span></p>
                <p>Ng√†y k·∫øt th√∫c: <span th:text="${#temporals.format(ticket.endDate, 'dd/MM/yyyy HH:mm')}"></span></p>
                <p>M√¥ t·∫£: <span th:text="${ticket.description}"></span></p>
                <p>L∆∞u √Ω: <span th:text="${ticket.note}"></span></p>
                <p th:text="|Gi√°: ${ticket.price} VND|"></p>
                <p class="ticket-status">
                    Tr·∫°ng th√°i:
                    <span th:text="${ticket.activatedAt != null or ticket.ticketType.name() == 'SINGLE' ? 'ƒê√£ k√≠ch ho·∫°t' : 'Ch∆∞a k√≠ch ho·∫°t'}"></span>
                </p>
            </div>
            <div class="ticket-actions">
                <img th:src="|data:image/png;base64,${ticket.qrCode}|" alt="QR Code"/>
                <th:block th:if="${ticket.ticketType != T(com.hsf302.enums.TicketType).SINGLE and ticket.activatedAt == null}">
                    <form th:action="@{'/tickets/activate/' + ${ticket.id}}" method="post">
                        <button type="submit">K√≠ch ho·∫°t v√©</button>
                    </form>
                </th:block>
            </div>
        </div>
    </div>

    <!-- ‚úÖ Ph√¢n trang -->
    <div class="pagination" th:if="${totalPages > 1}">
        <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
            <a th:href="@{/tickets(page=${i}, type=${activeTab})}"
               th:text="${i + 1}"
               th:classappend="${i == currentPage} ? 'active' : ''">
            </a>
        </span>
    </div>
</div>
</body>
</html>
